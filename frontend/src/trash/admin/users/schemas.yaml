User:
  allOf:
    - $ref: '../../common/jsonapi/schemas.yaml#/EntityIdentifier'
    - type: object
      properties:
        attributes:
          type: object
          properties:
            login:
              type: string
            email:
              type: string
          required:
            - login
            - email
        relationships:
          type: object
          properties:
            roles:
              $ref: '../../common/jsonapi/schemas.yaml#/EntityRelationIdentifierList'
            userInfo:
              $ref: '../../common/jsonapi/schemas.yaml#/EntityRelationIdentifier'
            categories:
              $ref: '../../common/jsonapi/schemas.yaml#/EntityRelationIdentifierList'
          required:
            - userInfo
        meta:
          $ref: '../../common/jsonapi/schemas.yaml#/CreateUpdateTimeMeta'
      required:
        - attributes
        - meta

UserInfo:
  allOf:
    - $ref: '../../common/jsonapi/schemas.yaml#/EntityIdentifier'
    - type: object
      properties:
        attributes:
          type: object
          properties:
            first_name:
              type: string
            last_name:
              type: string
            middle_name:
              type: string
            academic_group:
              type: string
            education_program:
              type: string
            course:
              type: string
            student_status:
              type: string
            compensation_type:
              type: string
            guid:
              type: string
            user_profile_id:
              type: integer
            entrance_year:
              type: string
            end_year:
              type: string
            is_archived:
              type: integer
          required:
            - first_name
            - middle_name
            - last_name
        meta:
          $ref: '../../common/jsonapi/schemas.yaml#/CreateUpdateTimeMeta'
      required:
        - attributes
        - meta

RoleSlugs:
  type: string
  enum:
    - verifier
    - student
    - admin
    - viewer
    - moderator

Role:
  allOf:
    - $ref: '../../common/jsonapi/schemas.yaml#/EntityIdentifier'
    - type: object
      properties:
        type:
          type: string
        id:
          type: integer
        attributes:
          type: object
          properties:
            slug:
              $ref: '#/RoleSlugs'
          required:
            - slug
        meta:
          $ref: '../../common/jsonapi/schemas.yaml#/CreateUpdateTimeMeta'
      required:
        - attributes
        - meta

UserMeta:
  type: object
  properties:
    meta:
      $ref: '../../common/jsonapi/schemas.yaml#/PaginationMeta'
  required:
    - meta

UserIncluded:
  type: object
  properties:
    included:
      type: array
      items:
        oneOf:
          - $ref: '#/UserInfo'
          - $ref: '#/Role'
          - $ref: '../categories/schemas.yaml#/AchievementCategory'
        discriminator:
          propertyName: type
  required:
    - included

UserListResponseBodyWithIncluded:
  allOf:
    - $ref: '#/UserIncluded'
    - $ref: '#/UserMeta'
    - type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/User'
      required:
        - data

UserResponseBodyWithIncluded:
  allOf:
    - $ref: '#/UserIncluded'
    - $ref: '#/UserMeta'
    - type: object
      properties:
        data:
          $ref: '#/User'
      required:
        - data

UserBaseResponseBody:
  allOf:
    - $ref: '#/UserIncluded'
    - $ref: '#/UserMeta'
    - type: object
      properties:
        data:
          $ref: '#/User'
      required:
        - data

RolesAssignmentRequestBody:
  type: object
  properties:
    data:
      type: object
      properties:
        type:
          type: string
          enum: ['users']
        attributes:
          type: object
          properties:
            roles:
              type: array
              items:
                $ref: '#/RoleSlugs'
          required:
            - roles
      required:
        - attributes
        - type
  required:
    - data

CategoriesAssignmentRequestBody:
  type: object
  properties:
    data:
      type: object
      properties:
        type:
          type: string
          enum: ['users']
        attributes:
          type: object
          properties:
            categories:
              type: array
              items:
                type: integer
          required:
            - categories
      required:
        - attributes
        - type
  required:
    - data
